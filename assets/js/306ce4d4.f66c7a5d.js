"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[844],{4137:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>k});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(a),m=r,k=u["".concat(s,".").concat(m)]||u[m]||d[m]||l;return a?n.createElement(k,i(i({ref:t},c),{},{components:a})):n.createElement(k,i({ref:t},c))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1560:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(4137));const l={id:"solution-prepare",sidebar_position:1,title:"Prepare"},i=void 0,o={unversionedId:"Create/solution-prepare",id:"Create/solution-prepare",title:"Prepare",description:"Pre-Requisites",source:"@site/docs/3-Create/Prepare.md",sourceDirName:"3-Create",slug:"/Create/solution-prepare",permalink:"/solution-satellite/Create/solution-prepare",draft:!1,editUrl:"https://github.com/ibm-client-engineering/solution-satellite/tree/main/packages/create-docusaurus/templates/shared/docs/3-Create/Prepare.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"solution-prepare",sidebar_position:1,title:"Prepare"},sidebar:"tutorialSidebar",previous:{title:"Create",permalink:"/solution-satellite/category/create"},next:{title:"Deploy",permalink:"/solution-satellite/Create/solution-deploy"}},s={},p=[{value:"Pre-Requisites",id:"pre-requisites",level:2},{value:"IBM Cloud",id:"ibm-cloud",level:3},{value:"Create API Key within Satellite Environment",id:"create-api-key-within-satellite-environment",level:4},{value:"Create SSH key",id:"create-ssh-key",level:4},{value:"Create COS Bucket",id:"create-cos-bucket",level:4},{value:"AWS",id:"aws",level:3},{value:"How to build Satellite Locations",id:"how-to-build-satellite-locations",level:2},{value:"IBM Cloud",id:"ibm-cloud-1",level:3},{value:"Export API Key",id:"export-api-key",level:4},{value:"Create .tfvars file",id:"create-tfvars-file",level:4},{value:"Execute Terraform scripts to build Locations",id:"execute-terraform-scripts-to-build-locations",level:4},{value:"Assign hosts to the control plane",id:"assign-hosts-to-the-control-plane",level:4},{value:"Create Red Hat OpenShift Service",id:"create-red-hat-openshift-service",level:4},{value:"AWS",id:"aws-1",level:3}],c={toc:p},u="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"pre-requisites"},"Pre-Requisites"),(0,r.kt)("h3",{id:"ibm-cloud"},"IBM Cloud"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"IBM Cloud environment with access to IBM Satellite"),(0,r.kt)("li",{parentName:"ul"},"Have the necessary permissions to create IAM API keys, SSH keys with full access to Satellite, ICD services, VPC infrastructure, VPC block storage, and access to increased quota limits"),(0,r.kt)("li",{parentName:"ul"},"Terraform installation"),(0,r.kt)("li",{parentName:"ul"},"API Key, SSH Key, COS bucket")),(0,r.kt)("h4",{id:"create-api-key-within-satellite-environment"},"Create API Key within Satellite Environment"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to Satellite environement on ",(0,r.kt)("a",{href:"https://cloud.ibm.com/",target:"_blank"},"IBM Cloud Console")),(0,r.kt)("li",{parentName:"ol"},"Select 'Manage' -> 'Access (IAM)' -> 'API Keys'"),(0,r.kt)("li",{parentName:"ol"},"Create a new API key and save/download key (will be used later)")),(0,r.kt)("h4",{id:"create-ssh-key"},"Create SSH key"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Within the side bar options navigate to 'VPC Infrastructure' -> 'SSH Keys'"),(0,r.kt)("li",{parentName:"ol"},"Select appropriate location and regions for the satellite location"),(0,r.kt)("li",{parentName:"ol"},"Populate 'name' and select the appropriate resource group"),(0,r.kt)("li",{parentName:"ol"},"Select 'RSA'"),(0,r.kt)("li",{parentName:"ol"},"Save the private and public keys and 'Create' (This will be used)")),(0,r.kt)("h4",{id:"create-cos-bucket"},"Create COS Bucket"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Go to satellite environement in IBM Cloud Console"),(0,r.kt)("li",{parentName:"ol"},'Click "Resources" in the side menu and click "Create Resource"'),(0,r.kt)("li",{parentName:"ol"},'Search "Object Storage" and select:',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},'Infrastructure: "IBM Cloud"'),(0,r.kt)("li",{parentName:"ul"},'Pricing Plan: "Standard"'))),(0,r.kt)("li",{parentName:"ol"},'Populate COS name and appropriate resource group in which satellite location is being built in and "Create"')),(0,r.kt)("h3",{id:"aws"},"AWS"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Have the correct IBM Cloud permissions to create locations"),(0,r.kt)("li",{parentName:"ul"},"Get AWS account access with the required permissions")),(0,r.kt)("h2",{id:"how-to-build-satellite-locations"},"How to build Satellite Locations"),(0,r.kt)("h3",{id:"ibm-cloud-1"},"IBM Cloud"),(0,r.kt)("h4",{id:"export-api-key"},"Export API Key"),(0,r.kt)("p",null,"Navigate to the working directory and run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"export TF_VAR_ibmcloud_api_key=<API key>\n")),(0,r.kt)("p",null,"The script expects the API key in ",(0,r.kt)("inlineCode",{parentName:"p"},"TF_VAR_ibmcloud_api_key")),(0,r.kt)("h4",{id:"create-tfvars-file"},"Create .tfvars file"),(0,r.kt)("p",null,"Create a file named ",(0,r.kt)("inlineCode",{parentName:"p"},"<location name>.tfvars")," (substitute your desired location name and ssh key) in the root directory of the repo (same directory as ",(0,r.kt)("inlineCode",{parentName:"p"},"install-icd.sh")," script)."),(0,r.kt)("p",null,"The following values are required:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-terraform"},'location_name     = "<location name>"\nis_location_exist = false\nmanaged_from      = "wdc"\nmanage_iam_policy = false\nregion            = "us-east"\nimage             = "ibm-redhat-8-6-minimal-amd64-3"\nexisting_ssh_key  = "<ssh key name>"\n\ncontrol_plane_hosts = { "name" : "cp", "count" : 3, "type" : "bx2-8x32" }\ncustomer_hosts      = { "name" : "customer", "count" : 3, "type" : "bx2-32x128" }\ninternal_hosts      = { "name" : "internal", "count" : 3, "type" : "bx2-8x32" }\nopenshift_hosts     = { "name" : "openshift", "count" : 3, "type" : "bx2-16x64" }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"location_name"),": name of the location"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"is_location_exist"),": if the location already exists before running this script, set this value to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"managed_from"),": needs to be an IBM Cloud region that is supported by IBM Cloud Databases on Satellite"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"manage_iam_policy"),": if the necessary IAM policies for the databases-for-* services already exist before running this script, set this value to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"region"),": the IBM Cloud region in which to deploy all VPC VSI, networks, etc. - should ideally correspond to the region picked in ",(0,r.kt)("inlineCode",{parentName:"li"},"managed_from")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"existing_ssh_key"),": VPC SSH Key name - this needs to exist in ",(0,r.kt)("inlineCode",{parentName:"li"},"region"))),(0,r.kt)("h4",{id:"execute-terraform-scripts-to-build-locations"},"Execute Terraform scripts to build Locations"),(0,r.kt)("p",null,"Login into IBM Cloud CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ibmcloud login -sso\n")),(0,r.kt)("p",null,"Target appropriate resource group"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ibmcloud target -g [resource group]\n")),(0,r.kt)("p",null,"When running for the first time, execute (in the repo root):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"terraform init\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"terraform plan -var-file=./[tvar input file].tfvars -out=./statefiles/[state file]\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'terraform apply "./statefiles/[state file]"\n')),(0,r.kt)("h4",{id:"assign-hosts-to-the-control-plane"},"Assign hosts to the control plane"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to Satellite environement on ",(0,r.kt)("a",{href:"https://cloud.ibm.com/",target:"_blank"},"IBM Cloud Console")),(0,r.kt)("li",{parentName:"ol"},"Within the sidebar go to 'Satellite' -> 'Locations' -> select ","[location_name]"),(0,r.kt)("li",{parentName:"ol"},"Within 'Getting started' -> 'Set up control plane' and 'Assign Hosts' (control_plane hosts) to the control plane")),(0,r.kt)("h4",{id:"create-red-hat-openshift-service"},"Create Red Hat OpenShift Service"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to Satellite environement on ",(0,r.kt)("a",{href:"https://cloud.ibm.com/",target:"_blank"},"IBM Cloud Console")),(0,r.kt)("li",{parentName:"ol"},"Click 'Create Service' -> 'Red Hat Openshift on IBM Cloud'"),(0,r.kt)("li",{parentName:"ol"},"Choose 'Custom Cluster', 'Satellite' (Infrastructure)"),(0,r.kt)("li",{parentName:"ol"},"Select appropraite resource group and desired satellite ","[location_name]"),(0,r.kt)("li",{parentName:"ol"},"Select configuration to match the available hosts you want to use"),(0,r.kt)("li",{parentName:"ol"},"'Enable cluster admin access for Satellite Config' - keep all other areas to default option"),(0,r.kt)("li",{parentName:"ol"},"Name cluster and 'Create'")),(0,r.kt)("h3",{id:"aws-1"},"AWS"))}d.isMDXComponent=!0}}]);